<!DOCTYPE html>
<html lang="en-us">

    <head>
        <style> 
            .grid-signal {
                grid-area: signal;
                background:  rgb(20, 128, 20); 
                padding: 2rem;
            }
            .grid-player-north {
                grid-area: north;
                background:  rgb(20, 128, 20); 
                padding: 2rem;
            }
            .grid-player-west {
                grid-area: west;
                background:  rgb(20, 128, 20); 
                padding: 2rem;
            }
            .grid-player-east {
                grid-area: east;
                background:  rgb(20, 128, 20); 
                padding: 2rem;
            }
            .grid-player-south {
                grid-area: south;
                background:  rgb(20, 128, 20); 
                padding: 2rem;
            }

            .grid-table {
                grid-area: table;
                border: 1px solid white;
                background:  darkgreen; 
                /* background:  rgb(20, 128, 20);  */
                padding: 2rem;
            }
            .grid-info {
                grid-area: info;
                text-align: center;
                background:  rgb(20, 128, 20); 
                padding: 2rem;
            }

            .container {
                display: grid;
                grid-template-columns: 175px 500px 175px 300px;
                grid-template-rows: auto;
                grid-template-areas: 
                    "signal  north   north  north"
                    "west    table   east   info"
                    "south   south   south  south"
                    "button  button  footer footer";
            }

            /* ----------------------------------------------------------------------- */

            .flexcontainer-table {
                display: flex;
                flex-direction: row;
            }
            
            .flexcontainer-vert {
                display: flex;
                flex-direction: column;
            }
            .table-player-north {
                padding-right: 10px;
                padding-bottom: 50px;
            }
            .table-player-south {
                padding-right: 10px;
            }
            .table-player-west {
                padding-top: 100px;
                padding-right: 10px;
                padding-left: 50px;
            }
            .table-player-east {
                padding-top: 100px;
            }

            .flexcontainer-player {
                display: flex;
                flex-flow: nowrap;
            }
            .player-card {
                padding-right: 10px;
            }

            /* ----------------------------------------------------------------------- */

            .card-size-normal {
                width:100px;
                height:150px;
            }
            .card-size-small {
                width:50px;
                height:75px;
            }

            /* ----------------------------------------------------------------------- */

            #winnerCard {
                transition-duration: 0.5s;
                transform: scale(1.5)
            }

        </style>
    </head>

    <body onload="showCardsInHands()">
        <div class="container">
            <div class="grid-signal"></div>
            <div class="grid-player-north">
                <div class="flexcontainer-player">
                    <div class="player-card"><img id="playerNorth0" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    <div class="player-card"><img id="playerNorth1" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    <div class="player-card"><img id="playerNorth2" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    <div class="player-card"><img id="playerNorth3" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    <div class="player-card"><img id="playerNorth4" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    <div class="player-card"><img id="playerNorth5" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    <div class="player-card"><img id="playerNorth6" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    <div class="player-card"><img id="playerNorth7" src="carddeck/NoCard.svg" class="card-size-small"></div>
                </div>    
            </div>
            
            <div class="grid-player-west">
                <div class="flexcontainer-player-vert">
                    <div class="flexcontainer-player">
                        <div class="player-card"><img id="playerWest0" src="carddeck/NoCard.svg" class="card-size-small"></div>
                        <div class="player-card"><img id="playerWest1" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    </div>
                    <div class="flexcontainer-player">
                        <div class="player-card"><img id="playerWest2" src="carddeck/NoCard.svg" class="card-size-small"></div>
                        <div class="player-card"><img id="playerWest3" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    </div>
                    <div class="flexcontainer-player">
                        <div class="player-card"><img id="playerWest4" src="carddeck/NoCard.svg" class="card-size-small"></div>
                        <div class="player-card"><img id="playerWest5" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    </div>
                    <div class="flexcontainer-player">
                        <div class="player-card"><img id="playerWest6" src="carddeck/NoCard.svg" class="card-size-small"></div>
                        <div class="player-card"><img id="playerWest7" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    </div>
                </div>    
            </div>
            
            <div class="grid-table">
                <div class="flexcontainer-table">
                    <div class="table-player-west"><img  id="tableWest" src="carddeck/NoCard.svg" class="card-size-normal"></div>
                    <div class="flexcontainer-column">
                        <div class="table-player-north"><img id="tableNorth" src="carddeck/NoCard.svg" class="card-size-normal"></div>
                        <div class="table-player-south"><img id="tableSouth" src="carddeck/NoCard.svg" class="card-size-normal"></div>
                    </div>
                    <div class="table-player-east"><img id="tableEast" src="carddeck/NoCard.svg" class="card-size-normal"></div>
                </div>    
            </div>

            <div class="grid-player-east">
                <div class="flexcontainer-player-vert">
                    <div class="flexcontainer-player">
                        <div class="player-card"><img id="playerEast0" src="carddeck/NoCard.svg" class="card-size-small"></div>
                        <div class="player-card"><img id="playerEast1" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    </div>
                    <div class="flexcontainer-player">
                        <div class="player-card"><img id="playerEast2" src="carddeck/NoCard.svg" class="card-size-small"></div>
                        <div class="player-card"><img id="playerEast3" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    </div>
                    <div class="flexcontainer-player">
                        <div class="player-card"><img id="playerEast4" src="carddeck/NoCard.svg" class="card-size-small"></div>
                        <div class="player-card"><img id="playerEast5" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    </div>
                    <div class="flexcontainer-player">
                        <div class="player-card"><img id="playerEast6" src="carddeck/NoCard.svg" class="card-size-small"></div>
                        <div class="player-card"><img id="playerEast7" src="carddeck/NoCard.svg" class="card-size-small"></div>
                    </div>
                </div>    
            </div>
            
            <div class="grid-info">
                Info
            </div>

            <div class="grid-player-south">
                <div class="flexcontainer-player">
                    <div class="player-card"><img id="playerSouth0" src="carddeck/NoCard.svg" class="card-size-normal"></div>
                    <div class="player-card"><img id="playerSouth1" src="carddeck/NoCard.svg" class="card-size-normal"></div>
                    <div class="player-card"><img id="playerSouth2" src="carddeck/NoCard.svg" class="card-size-normal"></div>
                    <div class="player-card"><img id="playerSouth3" src="carddeck/NoCard.svg" class="card-size-normal"></div>
                    <div class="player-card"><img id="playerSouth4" src="carddeck/NoCard.svg" class="card-size-normal"></div>
                    <div class="player-card"><img id="playerSouth5" src="carddeck/NoCard.svg" class="card-size-normal"></div>
                    <div class="player-card"><img id="playerSouth6" src="carddeck/NoCard.svg" class="card-size-normal"></div>
                    <div class="player-card"><img id="playerSouth7" src="carddeck/NoCard.svg" class="card-size-normal"></div>
                </div>    
            </div>            
        </div>        
        <button id="buttonPlay" onclick="computeMove()">PLAY</button>
        Card images by Adrian Kennard - Own work, CC0, <a href="https://commons.wikimedia.org/w/index.php?curid=70667162">https://commons.wikimedia.org/w/index.php?curid=70667162</a>    
    </body>


    <script>
        function NoCardImage() {
            return "carddeck/NoCard.SVG"
        }
        function cardModelToImageURL(cardModel) {
            if (cardModel == null) {
                return NoCardImage()
            }

            switch (cardModel.color) {
                case "SPADES":      colorString = "S"; break;
                case "HEARTS":      colorString = "H"; break;
                case "CLUBS":       colorString = "C"; break;
                case "DIAMONDS":    colorString = "D"; break;
            }
            switch (cardModel.rank) {
                case "TWO":     rankString = "2"; break;
                case "THREE":   rankString = "3"; break;
                case "FOUR":    rankString = "4"; break;
                case "FIVE":    rankString = "5"; break;
                case "SIX":     rankString = "6"; break;
                case "SEVEN":   rankString = "7"; break;
                case "EIGHT":   rankString = "8"; break;
                case "NINE":    rankString = "9"; break;
                case "TEN":     rankString = "10"; break;
                case "JACK":    rankString = "J"; break;
                case "QUEEN":   rankString = "Q"; break;
                case "KING":    rankString = "K"; break;
                case "ACE":     rankString = "A"; break;
            }
            return "carddeck/" + rankString + colorString + ".SVG"
        }

        function playerModelToTableImage(player) {
            switch (player) {
                case "SOUTH": return tableSouth;
                case "NORTH": return tableNorth;
                case "EAST":  return tableEast;
                case "WEST":  return tableWest;
            }
        }


        function showCard(cardId, cardModel, clickable) {
            var aCardImage = document.getElementById(cardId)
            aCardImage.src = cardModelToImageURL(cardModel)
            
            if (clickable) {
                aCardImage.onclick = function(){doMove(cardModel)};
                aCardImage.style.cursor = "pointer"
            }
        }

        function showPlayerCards(player, playerHand, clickable) {
            for (let cardIndex = 0; cardIndex < playerHand.length; cardIndex++) {
                showCard(player+cardIndex, playerHand[cardIndex], clickable)
            }            
        }

        function showCardsInAllHands(gameStatus) {
            showPlayerCards("playerSouth", gameStatus.playerSouth, true)
            showPlayerCards("playerWest", gameStatus.playerWest, false)
            showPlayerCards("playerNorth", gameStatus.playerNorth, false)
            showPlayerCards("playerEast", gameStatus.playerEast, false)
        }

        function findCardImage(cardModel) {
            src = cardModelToImageURL(cardModel)
            var allImages = document.getElementsByTagName('img');
            for(var i = 0; i < allImages.length ; i++) {
                if (allImages[i].src.indexOf(src) >= 0) {
                    return allImages[i];
                }
            }        
            return null
        }

        //-----------------------------------------------------------------------------------------

        function showMove(movePlayed) {
            var tableCardImage = playerModelToTableImage(movePlayed.player)
            var playerCardImage = findCardImage(movePlayed.cardPlayed)
            if (playerCardImage != null) {
                tableCardImage.src = playerCardImage.src
                playerCardImage.src = NoCardImage()
            } else {
                tableCardImage.src = cardModelToImageURL(movePlayed.cardPlayed)
            }

            if (movePlayed.roundCompleted) {
                clearTable(movePlayed.trickWinner, 1200)
                setTimeout(function() { showCardsInHands(); }, 3500)
                if (movePlayed.nextPlayer != "SOUTH") {
                    setTimeout(function() { computeMove(); }, 4000)
                }
            } else if (movePlayed.trickCompleted) {
                showCardsInHands()
                clearTable(movePlayed.trickWinner, 1200)
                if (movePlayed.nextPlayer != "SOUTH") {
                    setTimeout(function() { computeMove(); }, 1700)
                }
            } else if (movePlayed.nextPlayer != "SOUTH") {
                showCardsInHands()
                setTimeout(function() { computeMove(); }, 500)
            }
        }

        function clearTableAndResetWinner(winnerCardId) {            
            winnerCard.id = winnerCardId; 
            tableWest.src = NoCardImage();
            tableNorth.src = NoCardImage();
            tableEast.src = NoCardImage();
            tableSouth.src = NoCardImage();
        }

        function clearTable(trickWinner, wait) {
            var winningTableCard = playerModelToTableImage(trickWinner)
            if (winningTableCard == tableSouth) {
                tableSouth.id="winnerCard"
                setTimeout(function() { clearTableAndResetWinner("tableSouth"); }, wait);
            } else if (winningTableCard == tableWest) {
                tableWest.id="winnerCard"
                setTimeout(function() { clearTableAndResetWinner("tableWest"); }, wait);
            } else if (winningTableCard == tableNorth) {
                tableNorth.id="winnerCard"
                setTimeout(function() { clearTableAndResetWinner("tableNorth"); }, wait);
            } else if (winningTableCard == tableEast) { 
                tableEast.id="winnerCard"
                setTimeout(function() { clearTableAndResetWinner("tableEast"); }, wait);
            } else {
                console.log("Vreemd!!")
                //weird.....
            }
        }

        //-----------------------------------------------------------------------------------------

    </script>

    <script>
        function showCardsInHands() {
            var request = new XMLHttpRequest();

            request.open("GET", "/api/v1/game-status/");
            request.onreadystatechange = function() {
                if(this.readyState === 4 && this.status === 200) {
                    var gameStatus = JSON.parse(this.responseText);
                    showCardsInAllHands(gameStatus)
                }
            };
            request.send();
        }

        function computeMove() {
            var request = new XMLHttpRequest();

            request.open("POST", "/api/v1/computeMove/");
            request.onreadystatechange = function() {
                if(this.readyState === 4 && this.status === 200) {
                    var movePlayed = JSON.parse(this.responseText);
                    showMove(movePlayed)
                }
            };
            request.send();
        }

        function doMove(cardModel) {
            var request = new XMLHttpRequest();

            request.open("POST", "/api/v1/executeMove/" + cardModel.color + "/" + cardModel.rank);
            request.onreadystatechange = function() {
                if(this.readyState === 4 && this.status === 200) {
                    var movePlayed = JSON.parse(this.responseText);
                    showMove(movePlayed)
                } else if(this.readyState === 4 && this.status === 404) {
                    console.log("Kijk nou, een foutafvanging!!")
                }
            };
            request.send();
        }


    </script>

</html>
